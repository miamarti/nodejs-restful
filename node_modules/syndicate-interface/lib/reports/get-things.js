
var ObjectID = require('mongodb').ObjectID

var redis = require('../databases/redis')

module.exports = function* (options) {
  var offset = options.offset || 0
  var limit = options.limit || 25
  var res = yield redis.zrevrange('reports', offset, offset + limit - 1, 'WITHSCORES')
  var things = []
  for (var i = 0; i < res.length; i += 2) {
    var frags = res[i].split(':')
    things.push({
      _id: new ObjectID(frags[1]),
      collection: frags[0],
      count: {
        reports: res[i + 1]
      }
    })
  }
  return things
}
